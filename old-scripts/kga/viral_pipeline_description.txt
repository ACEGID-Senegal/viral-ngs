Kristian's shell script pipeline:


  1. Make required subdirectories
  2. Convert BAM files to FASTQ
  3. Perform de novo assembly of lassa reads using Trinity
  4. 
    1. Trim the reads with Trimmomatic
    2. LASTAL alignment to find relevant reads [Arenavirus reads only]
    3. de novo assembly using Trinity
    4. Align and orient contigs to references (VFAT)
    5. Sort contigs based on length (rsealfon script)
  5. Map lassa reads to modified contigs using Novoalign
  6. 
    1. Align references and contigs that passed length filter using muscle
    2. Clean up contigs (rsealfon script, dpark script)
    3. Index modified contigs (Picard fasta indexing)
    4. Novoalign lassa-only reads to modified contigs
    5. 
      1. Novoalign lassa-only fastq to modified contigs

      2. Sort/Index BAM alignments
      3. GATK UG, produce VCF with read counts (EMIT_ALL_SITES)
      4. Convert VCF to FASTA consensus sequence, re-calling SNPs based on read counts (dpark script)
    6. Index consensus sequences (Picard fasta indexing)
    7. Novoalign ALL reads to consensus sequences
    8. 
      1. Novoalign original fastq to consensus sequence
      2. Sort/Index BAM alignments
      3. GATK UG, produce VCF with read counts (EMIT_ALL_SITES)
      4. Convert VCF to FASTA consensus sequence, re-calling SNPs based on read counts (dpark script)
  7. Prepare final mapped assembly using Novoalign
  8. 
    1. Index final consensus sequences (Picard fasta indexing)
    2. Align all reads to its own lassa consensus sequence
    3. 
      1. Novoalign original fastq to final consensus sequence
      2. Sort/Index BAM alignments, mark&remove duplicates
  9. Prepare alignment and calculate metrics
  10. 
    1. Run fastqc report
    2. Perform local realignment (GATK)
    3. Calculate coverage & SNPs
    4. 
      1. Calculate coverage (BEDTools)
      2. GATK UG (EMIT_VARIANTS_ONLY, ploidy 10, AlleleBalance, etc)
      3. Filter SNPs (GATK VariantFiltration)
  11. Short meta analysis @ Broad
  12. 
    1. Subsample reads for later retrieval (custom script)
    2. Count spike-ins (Novoalign + custom script)
    3. Align to human or other reference using BWA
    4. Perform BLASTN analysis
    5. Create MEGAN files
  13. Clean up and get metrics
  14. 
    1. Something about excel reports -> CSV and processing those...
    2. Delete above temp/intermediate files
